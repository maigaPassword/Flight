{% extends "base.html" %}
{% block title %}Booking Confirmed{% endblock %}

{% block content %}
<section class="results-page confirmation-light">
  <div class="screen-only">
    <div class="confirmation-container">
    <div class="confirmation-header">
      <h1>Booking Confirmed</h1>
      <p class="confirmation-subtitle">Thank you! Your flight is booked and confirmed.</p>
    </div>

    <div class="status-badges">
      <div class="status-badge">
        <div class="badge-label">Status</div>
        <div class="badge-value confirmed">Confirmed</div>
      </div>
      <div class="status-badge">
        <div class="badge-label">Payment</div>
        <div class="badge-value paid">Paid</div>
      </div>
    </div>

    <div class="booking-reference">
      <div class="reference-label">Booking Reference</div>
      <div class="reference-code">{{ booking_ref }}</div>
      <p class="reference-note">We've sent a receipt and your itinerary to {{ email }}.</p>
      <div class="booking-id-info">
        <span>{{ now.strftime('%B %d, %Y') }}</span>
        <span>{{ now.strftime('%I:%M %p') }}</span>
      </div>
    </div>

    <!-- Traveller Details -->
    <div class="confirmation-section">
      <div class="section-title">
        <h3>Traveller Details</h3>
      </div>
      <div class="detail-grid">
        <div class="detail-item">
          <div class="detail-label">Passenger Name</div>
          <div class="detail-value">{{ passenger_name }}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">Email</div>
          <div class="detail-value">{{ email }}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">Phone</div>
          <div class="detail-value">{{ phone }}</div>
        </div>
      </div>
      {% if passenger_details and passenger_details|length > 0 %}
      <div class="passenger-list" style="margin-top: 1rem;">
        <div class="section-title">
          <h4>Passengers</h4>
        </div>
        <div class="detail-grid" style="grid-template-columns: 1fr 1fr 1fr;">
          {% for p in passenger_details %}
          <div class="detail-item">
            <div class="detail-label">Name</div>
            <div class="detail-value">{{ p.first_name }} {{ p.last_name }}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Type</div>
            <div class="detail-value">{{ p.type|capitalize }}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Nationality</div>
            <div class="detail-value">{{ p.nationality }}</div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Trip Summary -->
    <div class="confirmation-section">
      <div class="section-title">
        <h3>Trip Summary</h3>
      </div>

      <!-- Outbound -->
      <div class="flight-detail-card">
        <div class="flight-card-header">
          <span class="flight-badge outbound-badge">Outbound</span>
          {% if outbound.airline_name %}
          <div class="airline-info">
            <span class="airline-name">{{ outbound.airline_name }}</span>
          </div>
          {% endif %}
        </div>

        <div class="flight-route">
          <div class="route-point">
            <div class="route-time">{{ outbound.departure | time12 }}</div>
            <div class="route-city">{{ origin_city }}</div>
            <div class="route-code">{{ outbound.origin }}</div>
            <div class="route-date">{{ outbound.departure | date_compact }}</div>
          </div>
          <div class="route-middle">
            <div class="route-arrow">‚Üí</div>
            <div class="trip-duration">{{ outbound.duration }}</div>
          </div>
          <div class="route-point">
            <div class="route-time">{{ outbound.arrival | time12 }}</div>
            <div class="route-city">{{ destination_city }}</div>
            <div class="route-code">{{ outbound.destination }}</div>
            <div class="route-date">{{ outbound.arrival | date_compact }}</div>
          </div>
        </div>

        <div class="flight-meta-details">
          <div class="meta-item">
            <div class="meta-label">Cabin</div>
            <div class="meta-value">{{ cabin_out }}</div>
          </div>
          {% if outbound.stops_text %}
          <div class="meta-item">
            <div class="meta-label">Stops</div>
            <div class="meta-value">{{ outbound.stops_text }}</div>
          </div>
          {% endif %}
        </div>
      </div>

      {% if return_flight %}
      <!-- Return -->
      <div class="flight-detail-card">
        <div class="flight-card-header">
          <span class="flight-badge return-badge">Return</span>
          {% if return_flight.airline_name %}
          <div class="airline-info">
            <span class="airline-name">{{ return_flight.airline_name }}</span>
          </div>
          {% endif %}
        </div>

        <div class="flight-route">
          <div class="route-point">
            <div class="route-time">{{ return_flight.departure | time12 }}</div>
            <div class="route-city">{{ destination_city }}</div>
            <div class="route-code">{{ return_flight.origin }}</div>
            <div class="route-date">{{ return_flight.departure | date_compact }}</div>
          </div>
          <div class="route-middle">
            <div class="route-arrow">‚Üí</div>
            <div class="trip-duration">{{ return_flight.duration }}</div>
          </div>
          <div class="route-point">
            <div class="route-time">{{ return_flight.arrival | time12 }}</div>
            <div class="route-city">{{ origin_city }}</div>
            <div class="route-code">{{ return_flight.destination }}</div>
            <div class="route-date">{{ return_flight.arrival | date_compact }}</div>
          </div>
        </div>

        <div class="flight-meta-details">
          <div class="meta-item">
            <div class="meta-label">Cabin</div>
            <div class="meta-value">{{ cabin_ret }}</div>
          </div>
          {% if return_flight.stops_text %}
          <div class="meta-item">
            <div class="meta-label">Stops</div>
            <div class="meta-value">{{ return_flight.stops_text }}</div>
          </div>
          {% endif %}
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Payment Summary -->
    <div class="confirmation-section">
      <div class="section-title">
        <h3>Payment Summary</h3>
      </div>
      <div class="payment-summary">
        <div class="payment-total">
          <span>Total Paid</span>
          <span class="total-amount">${{ total_price }}</span>
        </div>
        <p class="payment-note">A receipt has been emailed to {{ email }}.</p>
      </div>
    </div>

    <div class="confirmation-actions">
      <button class="btn-download" onclick="window.print()">üñ®Ô∏è Print / Save as PDF</button>
      <a href="{{ url_for('home') }}" class="btn-home">üè† Back to Home</a>
    </div>
    </div>
  </div>

  <!-- PRINT-ONLY: Raw text/table layout for PDF -->
  <div class="print-only" style="display:none">
    <h1>Booking Confirmation</h1>
    <p>Reference: {{ booking_ref }}</p>
    <p>Date: {{ now.strftime('%Y-%m-%d') }} | Time: {{ now.strftime('%H:%M') }}</p>

    <h2>Traveller</h2>
    <table>
      <tr>
        <th>Passenger Name</th>
        <td>{{ passenger_name }}</td>
      </tr>
      <tr>
        <th>Email</th>
        <td>{{ email }}</td>
      </tr>
      <tr>
        <th>Phone</th>
        <td>{{ phone }}</td>
      </tr>
    </table>

    {% if passenger_details and passenger_details|length > 0 %}
    <h3>Passenger List</h3>
    <table>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Nationality</th>
      </tr>
      {% for p in passenger_details %}
      <tr>
        <td>{{ p.first_name }} {{ p.last_name }}</td>
        <td>{{ p.type|capitalize }}</td>
        <td>{{ p.nationality }}</td>
      </tr>
      {% endfor %}
    </table>
    {% endif %}

    <h2>Trip - Outbound</h2>
    <table>
      <tr>
        <th>From</th>
        <td>{{ origin_city }} ({{ outbound.origin }})</td>
      </tr>
      <tr>
        <th>To</th>
        <td>{{ destination_city }} ({{ outbound.destination }})</td>
      </tr>
      <tr>
        <th>Departure</th>
        <td>{{ outbound.departure | date_compact }} {{ outbound.departure | time12 }}</td>
      </tr>
      <tr>
        <th>Arrival</th>
        <td>{{ outbound.arrival | date_compact }} {{ outbound.arrival | time12 }}</td>
      </tr>
      <tr>
        <th>Duration</th>
        <td>{{ outbound.duration }}</td>
      </tr>
      <tr>
        <th>Cabin</th>
        <td>{{ cabin_out }}</td>
      </tr>
      {% if outbound.stops_text %}
      <tr>
        <th>Stops</th>
        <td>{{ outbound.stops_text }}</td>
      </tr>
      {% endif %}
    </table>

    {% if return_flight %}
    <h2>Trip - Return</h2>
    <table>
      <tr>
        <th>From</th>
        <td>{{ destination_city }} ({{ return_flight.origin }})</td>
      </tr>
      <tr>
        <th>To</th>
        <td>{{ origin_city }} ({{ return_flight.destination }})</td>
      </tr>
      <tr>
        <th>Departure</th>
        <td>{{ return_flight.departure | date_compact }} {{ return_flight.departure | time12 }}</td>
      </tr>
      <tr>
        <th>Arrival</th>
        <td>{{ return_flight.arrival | date_compact }} {{ return_flight.arrival | time12 }}</td>
      </tr>
      <tr>
        <th>Duration</th>
        <td>{{ return_flight.duration }}</td>
      </tr>
      <tr>
        <th>Cabin</th>
        <td>{{ cabin_ret }}</td>
      </tr>
      {% if return_flight.stops_text %}
      <tr>
        <th>Stops</th>
        <td>{{ return_flight.stops_text }}</td>
      </tr>
      {% endif %}
    </table>
    {% endif %}

    <h2>Payment</h2>
    <table>
      <tr>
        <th>Total Paid</th>
        <td>${{ total_price }}</td>
      </tr>
    </table>
  </div>
</section>
{% endblock %}
