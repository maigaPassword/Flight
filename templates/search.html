{% extends "base.html" %}

{% block content %}
<section class="results-page">

    <!-- ===== PAGE HEADER ===== -->
    <h2>Search Flights</h2>

    <!-- ===== FLIGHT SEARCH FORM ===== -->
    <form id="flightForm" class="search-form" method="POST" action="/search">

        <!-- ===== ORIGIN INPUT ===== -->
        <div class="autocomplete" style="position: relative;">
            <input type="text" name="origin_display" id="origin" class="airport-input" placeholder="Origin" required autocomplete="off">
            <input type="hidden" name="origin" id="origin_code">
        </div>

        <!-- ===== DESTINATION INPUT ===== -->
        <div class="autocomplete" style="position: relative;">
            <input type="text" name="destination_display" id="destination" class="airport-input" placeholder="Destination" required autocomplete="off">
            <input type="hidden" name="destination" id="destination_code">
        </div>

        <!-- ===== DATE INPUT ===== -->
        <input type="date" name="date" id="date" value="{{ searched_date }}" required>

        <!-- ===== SUBMIT BUTTON ===== -->
        <button type="submit" class="btn">Search</button>
    </form>

    <!-- ===== DATE SLIDER ===== -->
    <div id="date-slider-wrapper">
        <button id="prev-date" class="slider-nav">&lt;</button>
        <div id="date-slider-container" data-origin="{{ origin }}" data-destination="{{ destination }}">
            {% for date in date_range %}
                <button class="date-btn {% if date == searched_date %}active{% endif %}" data-date="{{ date }}">
                    {{ date|format_date }}
                    <br>
                    <span class="min-price">
                        {% if min_prices[date] is not none %}${{ "%.2f"|format(min_prices[date]) }}{% else %}-{% endif %}
                    </span>
                </button>
            {% endfor %}
        </div>
        <button id="next-date" class="slider-nav">&gt;</button>
    </div>

    <!-- ===== FILTERS ===== -->
    <div class="filters">
        <label for="sort-options">Sort by:</label>
        <select id="sort-options">
            <option value="price">Price</option>
            <option value="duration">Duration</option>
            <option value="airline">Airline</option>
        </select>
    </div>

    <!-- ===== FLIGHT RESULTS ===== -->
    <div id="flights-container">
        {% for flight in flights %}
            <div class="flight-card"
                data-offer-id="{{ flight.offer_id }}"
                data-airline="{{ flight.airline_name }}"
                data-logo="{{ flight.airline_logo }}"
                data-origin="{{ flight.origin }}"
                data-destination="{{ flight.destination }}"
                data-price="{{ flight.price }}"
                data-stops="{{ flight.stops_text }}"
                data-segments='{{ flight.segments | tojson | safe }}'
                data-flight='{{ flight | tojson | safe }}'>

                <!-- ===== FLIGHT HEADER ===== -->
                <div class="flight-header">
                    {% if flight.airline_logo %}
                        <img src="{{ flight.airline_logo }}" alt="{{ flight.airline_name }}" class="airline-logo">
                    {% endif %}
                    <h3>{{ flight.airline_name }}</h3>
                    <p class="price">
                        ${{ flight.fares_by_cabin.values() | map(attribute=0) | map(attribute='price') | min }}
                    </p>
                </div>

                <!-- ===== FLIGHT ROUTE & STOPS ===== -->
                <p class="route" data-origin="{{ flight.origin }}" data-destination="{{ flight.destination }}"></p>
                <p class="stops">{{ flight.stops_text }}</p>

                <!-- ===== FLIGHT ACTION BUTTONS ===== -->
                <button class="select-btn">Select Flight</button>
                <button class="show-more-btn select-btn">Show More</button>
            </div>
        {% endfor %}
    </div>
</section>

<!-- ===== POPUP MODAL FOR FLIGHT DETAILS ===== -->
<div id="flightModal" class="flight-modal">
    <div class="flight-modal-content">
        <span class="flight-close-btn">&times;</span>
        <div id="flightModalBody"></div>
    </div>
</div>

<!-- ===== JAVASCRIPT VARIABLES ===== -->
<script>
const AIRPORTS = {{ AIRPORTS | tojson | safe }};
</script>

{% endblock %}
